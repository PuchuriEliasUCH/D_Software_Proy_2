<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Mesas y Reservas — DASSO by StoqING</title>

    <!-- Fuentes iguales que en el resto del proyecto -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200;500&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/mesas-reservas.css">
</head>
<body>
<!-- HEADER UNIFICADO -->
<header th:insert="~{/fragments/general/navbar :: navbar}"></header>

<main class="container-main">
    <div class="card">
        <!-- TÍTULO + BOTONES SUPERIORES -->
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:18px;">
            <h4>Gestión de Mesas y Reservas</h4>
            <div style="display:flex;gap:8px;">
                <button id="dashboardBtn" class="btn btn-secondary" type="button">Volver al Dashboard</button>
                <button id="logoutBtn" class="btn btn-outline-danger" type="button">Cerrar sesión</button>
            </div>
        </div>

        <!-- FECHA + INFO VISTA -->
        <div style="display:flex;gap:12px;align-items:center;margin-bottom:18px;flex-wrap:wrap">
            <label class="small-muted" for="mesasDate" style="min-width:90px">Fecha:</label>
            <input id="mesasDate" type="date" class="form-control" style="max-width:180px"/>
        </div>

        <!-- LAYOUT MAPA + ASIDE RESERVAS -->
        <div class="mesas-layout">
            <!-- COLUMNA IZQUIERDA: MAPA DE MESAS -->
            <section class="mesas-layout__mapa" aria-label="Mapa de mesas">
                <h5>Mapa de mesas</h5>

                <div class="legend">
                    <div><span class="legend-box estado-libre"></span> Libre</div>
                    <div><span class="legend-box estado-solicitada"></span> Solicitada</div>
                    <div><span class="legend-box estado-reservada"></span> Reservada</div>
                    <div><span class="legend-box estado-ocupada"></span> Ocupada</div>
                    <div><span class="legend-box estado-mantenimiento"></span> Mantenimiento</div>
                </div>

                <div id="mesasMap"></div>

                <div class="small-muted" style="margin-top:8px">
                    Haz clic en una mesa (si NO está vinculada a una reserva) para abrir
                    <em>Opciones de mesa</em>.
                </div>
            </section>



            <!-- COLUMNA DERECHA: ASIDE LISTA RESERVAS -->
            <aside id="reservasMesas" class="mesas-layout__reservas" aria-label="Lista de reservas del día"

            >
                <div class="mesas-layout__reservas-header">
                    <h5 class="mb-0">Lista de reservas del día</h5>
                    <div class="mesas-layout__reservas-filter">
                        <label class="small-muted" for="reservasEstadoFilter">Filtrar por estado:</label>
                        <select id="reservasEstadoFilter" class="form-control" style="max-width:220px" onchange="relistar()">
                            <option value="0" selected>Todas</option>
                            <option value="1">Pendiente de pago</option>
                            <option value="2">Programada</option>
                            <option value="6">En curso</option>
                            <option value="7">Finalizada</option>
                            <option value="3">Expiradas</option>
                            <option value="4">Cancelada por el cliente</option>
                            <option value="5">Cancelada por inconvenientes</option>
                            <option value="8">No show</option>
                        </select>
                    </div>
                </div>

                <div th:replace="~{fragments/mesas/lista_reservas.html :: listaReservas}"></div>
            </aside>
        </div>
        <!-- FIN LAYOUT MAPA + ASIDE -->

    </div>
</main>

<!-- MODAL OPCIONES DE MESA -->
<div id="tableOptionsModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.35); align-items:center; justify-content:center; z-index:9999;">
    <div class="card" style="width:520px; max-width:calc(100% - 24px)">
        <h5>Opciones de mesa</h5>
        <div id="tableOptInfo" class="small-muted" style="margin-bottom:8px"></div>
        <div class="mb-2">
            <label class="form-label" for="tableStateSelect">Estado manual</label>
            <select id="tableStateSelect" class="form-control">
                <option value="libre">Libre (por defecto)</option>
                <option value="ocupada">Ocupada (manual)</option>
                <option value="mantenimiento">En mantenimiento</option>
            </select>
        </div>
        <div id="maintUntilWrap" class="mb-2" style="display:none">
            <label class="form-label" for="maintUntil">Mantenimiento hasta (opcional)</label>
            <input id="maintUntil" type="datetime-local" class="form-control"/>
            <small class="small-muted">Al llegar la hora, la mesa vuelve a “Libre” automáticamente.</small>
        </div>
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
            <button id="tableOptCancel" class="btn btn-outline-secondary" type="button">Cancelar</button>
            <button id="tableOptSave" class="btn btn-dark" type="button">Guardar</button>
        </div>
    </div>
</div>

<!-- MODAL EDITAR RESERVA -->
<div id="editModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.35); align-items:center; justify-content:center; z-index:9999;">
    <div class="card" style="width:560px; max-width:calc(100% - 24px)">
        <h5>Reprogramar reserva</h5>
        <div id="editInfo" class="small-muted"></div>
        <div class="mb-2" id="editSlots" style="display:flex;flex-wrap:wrap;gap:8px;margin-top:10px"></div>
        <div id="editMsg" class="small-muted" style="color:#dc3545"></div>
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
            <button id="editCancel" class="btn btn-outline-secondary" type="button">Cancelar</button>
            <button id="editSave" class="btn btn-dark" type="button">Guardar</button>
        </div>
    </div>
</div>

<script src="js/mesas-reservas.js"></script>
</body>
</html>
